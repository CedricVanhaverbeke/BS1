<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>perl591delta - perldoc.perl.org</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Language" content="en-gb" />
  <link href="css.css" rel="stylesheet" rev="stylesheet" type="text/css" media="screen" />
  <link rel="search" type="application/opensearchdescription+xml" title="Perldoc" href="opensearch.html">
</head>

<script language="JavaScript" type="text/javascript" src="label.js"></script>

<script language="JavaScript">
  pageDepth = 0;
  setPath();
</script>

<body onLoad="showToolbars();loadLabels()">

<div id="pageHeader">
  <div id="pageHeaderLogo">
    <img src="onion.gif">
  </div>
  <div id="pageHeaderText">
    <a href="http://perldoc.perl.org">perldoc.perl.org</a>
  </div>
</div>

<div id="pageBody">
  <div id="left">
    <div id="leftContent">
      <div id="leftClose">
        <a href="#" onClick="closeLeft()" title="Hide navigation" onmouseover="leftCloseIcon.src='close_purple.gif';" onmouseout="leftCloseIcon.src='close_blue.gif';"><img src="close_blue.gif" name="leftCloseIcon" id="leftCloseIcon" border=0></a>
      </div>
      <h1>Manual:</h1>
      <ul>
        <li><a href="index-overview.html">Overview</a></li>
        <li><a href="index-tutorials.html">Tutorials</a></li>
        <li><a href="index-faq.html">FAQs</a></li>
        <li><a href="index-history.html">History / Changes</a></li>
        <li><a href="index-licence.html">Licence</a></li>
      </ul>
      <h2>Reference:</h2>
      <ul>
        <li><a href="index-language.html">Language</a></li>
        <li><a href="index-functions.html">Functions</a></li>
        <li><a href="perlop.html">Operators</a></li>
        <li><a href="perlvar.html">Special variables</a></li>
        <li><a href="index-pragmas.html">Pragmas</a></li>
        <li><a href="index-modules-A.html">Core modules</a></li>
        <li><a href="index-utilities.html">Utilities</a></li>
        <li><a href="index-internals.html">Internals</a></li>
        <li><a href="index-platforms.html">Platform specific</a></li>
      </ul>
    </div>
  </div>

  <div id="center">  
    <div id="centerContent">
      <div id="contentHeader">
        <div id="contentHeaderLeft"><a href="#" onClick="showLeft()">Show navigation</a></div>
        <div id="contentHeaderCentre">-- Perl 5.10.0 documentation --</div>
        <div id="contentHeaderRight"><a href="#" onClick="showRight()">Show toolbar</a></div>
      </div>
      <div id="breadCrumbs"><a href="index.html">Home</a> &gt; <a href="index-history.html">History / Changes</a> &gt; perl591delta</div>
      <script language="JavaScript">fromSearch();</script>
      <div id="contentBody"><div class="title_container"><div class="page_title">perl591delta</div><ul><li><a href="#NAME">NAME</a><li><a href="#DESCRIPTION">DESCRIPTION</a><li><a href="#Incompatible-Changes">Incompatible Changes</a><ul><li><a href="#substr()-lvalues-are-no-longer-fixed-length">substr() lvalues are no longer fixed-length</a><li><a href="#The-'0x3aunique'-attribute-is-only-meaningful-for-globals">The <code class="inline"><span class="j">:</span><span class="w">unique</span></code>
 attribute is only meaningful for globals</a></ul><li><a href="#Core-Enhancements">Core Enhancements</a><ul><li><a href="#Lexical-'0x24_'">Lexical <code class="inline"><span class="i">$_</span></code>
</a><li><a href="#Tied-hashes-in-scalar-context">Tied hashes in scalar context</a><li><a href="#Formats">Formats</a><li><a href="#Stacked-filetest-operators">Stacked filetest operators</a></ul><li><a href="#Modules-and-Pragmata">Modules and Pragmata</a><li><a href="#Utility-Changes">Utility Changes</a><li><a href="#Documentation">Documentation</a><li><a href="#Performance-Enhancements">Performance Enhancements</a><li><a href="#Selected-Bug-Fixes">Selected Bug Fixes</a><ul><li><a href="#UTF-8-bugs">UTF-8 bugs</a><li><a href="#Threading-bugs">Threading bugs</a><li><a href="#More-bugs">More bugs</a></ul><li><a href="#New-or-Changed-Diagnostics">New or Changed Diagnostics</a><li><a href="#Changed-Internals">Changed Internals</a><ul><li><a href="#Reordering-of-SVt_*-constants">Reordering of SVt_* constants</a><li><a href="#Removal-of-CPP-symbols">Removal of CPP symbols</a><li><a href="#Less-space-is-used-by-ops">Less space is used by ops</a><li><a href="#New-parser">New parser</a></ul><li><a href="#Configuration-and-Building">Configuration and Building</a><li><a href="#Known-Problems">Known Problems</a><ul><li><a href="#Platform-Specific-Problems">Platform Specific Problems</a></ul><li><a href="#To-do-for-perl-5.10.0">To-do for perl 5.10.0</a><li><a href="#Reporting-Bugs">Reporting Bugs</a><li><a href="#SEE-ALSO">SEE ALSO</a></ul><a name="NAME"></a><h1>NAME</h1>
<p>perl591delta - what is new for perl v5.9.1</p>
<a name="DESCRIPTION"></a><h1>DESCRIPTION</h1>
<p>This document describes differences between the 5.9.0 and the 5.9.1
development releases. See <a href="perl590delta.html">perl590delta</a> for the differences between
5.8.0 and 5.9.0.</p>
<a name="Incompatible-Changes"></a><h1>Incompatible Changes</h1>
<a name="substr()-lvalues-are-no-longer-fixed-length"></a><h2>substr() lvalues are no longer fixed-length</h2>
<p>The lvalues returned by the three argument form of substr() used to be a
"fixed length window" on the original string. In some cases this could
cause surprising action at distance or other undefined behaviour. Now the
length of the window adjusts itself to the length of the string assigned to
it.</p>
<a name="The-'0x3aunique'-attribute-is-only-meaningful-for-globals"></a><h2>The <code class="inline"><span class="j">:</span><span class="w">unique</span></code>
 attribute is only meaningful for globals</h2>
<p>Now applying <code class="inline"><span class="j">:</span><span class="w">unique</span></code>
 to lexical variables and to subroutines will
result in a compilation error.</p>
<a name="Core-Enhancements"></a><h1>Core Enhancements</h1>
<a name="Lexical-'0x24_'"></a><h2>Lexical <code class="inline"><span class="i">$_</span></code>
</h2>
<p>The default variable <code class="inline"><span class="i">$_</span></code>
 can now be lexicalized, by declaring it like
any other lexical variable, with a simple</p>
<pre class="verbatim">    <a class="l_k" href="functions/my.html">my</a> <span class="i">$_</span><span class="sc">;</span></pre>
<p>The operations that default on <code class="inline"><span class="i">$_</span></code>
 will use the lexically-scoped
version of <code class="inline"><span class="i">$_</span></code>
 when it exists, instead of the global <code class="inline"><span class="i">$_</span></code>
.</p>
<p>In a <code class="inline"><a class="l_k" href="functions/map.html">map</a></code> or a <code class="inline"><a class="l_k" href="functions/grep.html">grep</a></code> block, if <code class="inline"><span class="i">$_</span></code>
 was previously my'ed, then the
<code class="inline"><span class="i">$_</span></code>
 inside the block is lexical as well (and scoped to the block).</p>
<p>In a scope where <code class="inline"><span class="i">$_</span></code>
 has been lexicalized, you can still have access to
the global version of <code class="inline"><span class="i">$_</span></code>
 by using <code class="inline"><span class="i">$::_</span></code>
, or, more simply, by
overriding the lexical declaration with <code class="inline"><a class="l_k" href="functions/our.html">our</a> <span class="i">$_</span></code>
.</p>
<a name="Tied-hashes-in-scalar-context"></a><h2>Tied hashes in scalar context</h2>
<p>As of perl 5.8.2/5.9.0, tied hashes did not return anything useful in
scalar context, for example when used as boolean tests:</p>
<pre class="verbatim">	if <span class="s">(</span><span class="i">%tied_hash</span><span class="s">)</span> <span class="s">{</span> ... <span class="s">}</span></pre>
<p>The old nonsensical behaviour was always to return false,
regardless of whether the hash is empty or has elements.</p>
<p>There is now an interface for the implementors of tied hashes to implement
the behaviour of a hash in scalar context, via the SCALAR method (see
<a href="perltie.html">perltie</a>).  Without a SCALAR method, perl will try to guess whether
the hash is empty, by testing if it's inside an iteration (in this case
it can't be empty) or by calling FIRSTKEY.</p>
<a name="Formats"></a><h2>Formats</h2>
<p>Formats were improved in several ways. A new field, <code class="inline">^*</code>, can be used for
variable-width, one-line-at-a-time text. Null characters are now handled
correctly in picture lines. Using <code class="inline"><span class="i">@#</span></code>
 and <code class="inline">~~</code>
 together will now
produce a compile-time error, as those format fields are incompatible.
<a href="perlform.html">perlform</a> has been improved, and miscellaneous bugs fixed.</p>
<a name="Stacked-filetest-operators"></a><h2>Stacked filetest operators</h2>
<p>As a new form of syntactic sugar, it's now possible to stack up filetest
operators. You can now write <code class="inline">-f -w -x <span class="i">$file</span></code>
 in a row to mean
<code class="inline">-x <span class="i">$file</span> &amp;&amp; -w <span class="i">_</span> &amp;&amp; -f <span class="i">_</span></code>
. See <a href="functions/-X.html">-X</a>.</p>
<a name="Modules-and-Pragmata"></a><h1>Modules and Pragmata</h1>
<ul>
<li><a name="Benchmark"></a><b>Benchmark</b>
<p>In <code class="inline"><span class="w">Benchmark</span></code>
, cmpthese() and timestr() now use the time statistics of
children instead of parent when the selected style is 'nop'.</p>
</li>
<li><a name="Carp"></a><b>Carp</b>
<p>The error messages produced by <code class="inline"><span class="w">Carp</span></code>
 now include spaces between the
arguments in function argument lists: this makes long error messages
appear more nicely in browsers and other tools.</p>
</li>
<li><a name="Exporter"></a><b>Exporter</b>
<p><code class="inline"><span class="w">Exporter</span></code>
 will now recognize grouping tags (such as <code class="inline"><span class="j">:</span><span class="w">name</span></code>
) anywhere
in the import list, not only at the beginning.</p>
</li>
<li><a name="FindBin"></a><b>FindBin</b>
<p>A function <code class="inline"><span class="w">again</span></code>
 is provided to resolve problems where modules in different
directories wish to use FindBin.</p>
</li>
<li><a name="List0x3a0x3aUtil"></a><b>List::Util</b>
<p>You can now weaken references to read only values.</p>
</li>
<li><a name="threads0x3a0x3ashared"></a><b>threads::shared</b>
<p><code class="inline"><span class="w">cond_wait</span></code>
 has a new two argument form. <code class="inline"><span class="w">cond_timedwait</span></code>
 has been added.</p>
</li>
</ul>
<a name="Utility-Changes"></a><h1>Utility Changes</h1>
<p><code class="inline"><span class="w">find2perl</span></code>
 now assumes <code class="inline">-<a class="l_k" href="functions/print.html">print</a></code>
 as a default action. Previously, it
needed to be specified explicitly.</p>
<p>A new utility, <code class="inline"><span class="w">prove</span></code>
, makes it easy to run an individual regression test
at the command line. <code class="inline"><span class="w">prove</span></code>
 is part of Test::Harness, which users of earlier
Perl versions can install from CPAN.</p>
<p>The perl debugger now supports a <code class="inline"><span class="w">save</span></code>
 command, to save the current
history to a file, and an <code class="inline"><span class="w">i</span></code>
 command, which prints the inheritance tree
of its argument (if the <code class="inline"><span class="w">Class::ISA</span></code>
 module is installed.)</p>
<a name="Documentation"></a><h1>Documentation</h1>
<p>The documentation has been revised in places to produce more standard manpages.</p>
<p>The long-existing feature of <code class="inline"><span class="q">/(?{...})/</span></code>
 regexps setting <code class="inline"><span class="i">$_</span></code>
 and pos()
is now documented.</p>
<a name="Performance-Enhancements"></a><h1>Performance Enhancements</h1>
<p>Sorting arrays in place (<code class="inline"><span class="i">@a</span> = <a class="l_k" href="functions/sort.html">sort</a> <span class="i">@a</span></code>
) is now optimized to avoid
making a temporary copy of the array.</p>
<p>The operations involving case mapping on UTF-8 strings (uc(), lc(),
<code class="inline"><span class="q">//i</span></code>
, etc.) have been greatly speeded up.</p>
<p>Access to elements of lexical arrays via a numeric constant between 0 and
255 is now faster. (This used to be only the case for global arrays.)</p>
<a name="Selected-Bug-Fixes"></a><h1>Selected Bug Fixes</h1>
<a name="UTF-8-bugs"></a><h2>UTF-8 bugs</h2>
<p>Using substr() on a UTF-8 string could cause subsequent accesses on that
string to return garbage. This was due to incorrect UTF-8 offsets being
cached, and is now fixed.</p>
<p>join() could return garbage when the same join() statement was used to
process 8 bit data having earlier processed UTF-8 data, due to the flags
on that statement's temporary workspace not being reset correctly. This
is now fixed.</p>
<p>Using Unicode keys with tied hashes should now work correctly.</p>
<p>chop() and chomp() used to mangle UTF-8 strings.  This has been fixed.</p>
<p>sprintf() used to misbehave when the format string was in UTF-8. This is
now fixed.</p>
<a name="Threading-bugs"></a><h2>Threading bugs</h2>
<p>Hashes with the <code class="inline"><span class="j">:</span><span class="w">unique</span></code>
 attribute weren't made read-only in new
threads. They are now.</p>
<a name="More-bugs"></a><h2>More bugs</h2>
<p><code class="inline"><span class="i">$a</span> .. <span class="i">$b</span></code>
 will now work as expected when either $a or $b is <code class="inline"><a class="l_k" href="functions/undef.html">undef</a></code>.</p>
<p>Reading $^E now preserves $!. Previously, the C code implementing $^E
did not preserve <code class="inline"><span class="w">errno</span></code>
, so reading $^E could cause <code class="inline"><span class="w">errno</span></code>
 and therefore
<code class="inline"><span class="i">$!</span></code>
 to change unexpectedly.</p>
<p><code class="inline"><span class="w">strict</span></code>
 wasn't in effect in regexp-eval blocks (<code class="inline"><span class="q">/(?{...})/</span></code>
).</p>
<a name="New-or-Changed-Diagnostics"></a><h1>New or Changed Diagnostics</h1>
<p>A new deprecation warning, <i>Deprecated use of my() in false conditional</i>,
has been added, to warn against the use of the dubious and deprecated
construct</p>
<pre class="verbatim">    <a class="l_k" href="functions/my.html">my</a> <span class="i">$x</span> if <span class="n">0</span><span class="sc">;</span></pre>
<p>See <a href="perldiag.html">perldiag</a>.</p>
<p>The fatal error <i>DESTROY created new reference to dead object</i> is now
documented in <a href="perldiag.html">perldiag</a>.</p>
<p>A new error, <i>%ENV is aliased to %s</i>, is produced when taint checks are
enabled and when <code class="inline"><span class="i">*ENV</span></code>
 has been aliased (and thus doesn't reflect the
program's environment anymore.)</p>
<a name="Changed-Internals"></a><h1>Changed Internals</h1>
<p>These news matter to you only if you either write XS code or like to
know about or hack Perl internals (using Devel::Peek or any of the
<code class="inline"><span class="w">B::</span></code>
 modules counts), or like to run Perl with the <code class="inline">-<span class="w">D</span></code>
 option.</p>
<a name="Reordering-of-SVt_*-constants"></a><h2>Reordering of SVt_* constants</h2>
<p>The relative ordering of constants that define the various types of <code class="inline"><span class="w">SV</span></code>

have changed; in particular, <code class="inline"><span class="w">SVt_PVGV</span></code>
 has been moved before <code class="inline"><span class="w">SVt_PVLV</span></code>
,
<code class="inline"><span class="w">SVt_PVAV</span></code>
, <code class="inline"><span class="w">SVt_PVHV</span></code>
 and <code class="inline"><span class="w">SVt_PVCV</span></code>
.  This is unlikely to make any
difference unless you have code that explicitly makes assumptions about that
ordering. (The inheritance hierarchy of <code class="inline"><span class="w">B::</span>*</code>
 objects has been changed
to reflect this.)</p>
<a name="Removal-of-CPP-symbols"></a><h2>Removal of CPP symbols</h2>
<p>The C preprocessor symbols <code class="inline"><span class="w">PERL_PM_APIVERSION</span></code>
 and
<code class="inline"><span class="w">PERL_XS_APIVERSION</span></code>
, which were supposed to give the version number of
the oldest perl binary-compatible (resp. source-compatible) with the
present one, were not used, and sometimes had misleading values. They have
been removed.</p>
<a name="Less-space-is-used-by-ops"></a><h2>Less space is used by ops</h2>
<p>The <code class="inline"><span class="w">BASEOP</span></code>
 structure now uses less space. The <code class="inline"><span class="w">op_seq</span></code>
 field has been
removed and replaced by two one-bit fields, <code class="inline"><span class="w">op_opt</span></code>
 and <code class="inline"><span class="w">op_static</span></code>
.
<code class="inline"><span class="w">opt_type</span></code>
 is now 9 bits long. (Consequently, the <code class="inline"><span class="w">B::OP</span></code>
 class doesn't
provide an <code class="inline"><span class="w">seq</span></code>
 method anymore.)</p>
<a name="New-parser"></a><h2>New parser</h2>
<p>perl's parser is now generated by bison (it used to be generated by
byacc.) As a result, it seems to be a bit more robust.</p>
<a name="Configuration-and-Building"></a><h1>Configuration and Building</h1>
<p><code class="inline"><span class="w">Configure</span></code>
 now invokes callbacks regardless of the value of the variable
they are called for. Previously callbacks were only invoked in the
<code class="inline">case $variable $define)</code> branch. This change should only affect platform
maintainers writing configuration hints files.</p>
<p>The portability and cleanliness of the Win32 makefiles has been improved.</p>
<a name="Known-Problems"></a><h1>Known Problems</h1>
<p>There are still a couple of problems in the implementation of the lexical
<code class="inline"><span class="i">$_</span></code>
: it doesn't work inside <code class="inline"><span class="q">/(?{...})/</span></code>
 blocks and with regard to the
reverse() built-in used without arguments. (See the TODO tests in
<i>t/op/mydef.t</i>.)</p>
<a name="Platform-Specific-Problems"></a><h2>Platform Specific Problems</h2>
<p>The test <i>ext/IPC/SysV/t/ipcsysv.t</i> may fail on OpenBSD. This hasn't been
diagnosed yet.</p>
<p>On some configurations on AIX 5, one test in <i>lib/Time/Local.t</i> fails.
When configured with long doubles, perl may fail tests 224-236 in
<i>t/op/pow.t</i> on the same platform.</p>
<p>For threaded builds, <i>ext/threads/shared/t/wait.t</i> has been reported to
fail some tests on HP-UX 10.20.</p>
<a name="To-do-for-perl-5.10.0"></a><h1>To-do for perl 5.10.0</h1>
<p>This is a non-exhaustive, non-ordered, non-contractual and non-definitive
list of things to do (or nice to have) for perl 5.10.0 :</p>
<p>Clean up and finish support for assertions. See <a href="http://search.cpan.org/perldoc/assertions">assertions</a>.</p>
<p>Reimplement the mechanism of lexical pragmas to be more extensible. Fix
current pragmas that don't work well (or at all) with lexical scopes or in
run-time eval(STRING) (<code class="inline"><a class="l_k" href="functions/sort.html">sort</a></code>, <code class="inline"><span class="w">re</span></code>
, <code class="inline"><span class="w">encoding</span></code>
 for example). MJD has a
preliminary patch that implements this.</p>
<p>Fix (or rewrite) the implementation of the <code class="inline"><span class="q">/(?{...})/</span></code>
 closures.</p>
<p>Conversions from byte strings to UTF-8 currently map high bit characters
to Unicode without translation (or, depending on how you look at it, by
implicitly assuming that the byte strings are in Latin-1). As perl assumes
the C locale by default, upgrading a string to UTF-8 may change the
meaning of its contents regarding character classes, case mapping, etc.
This should probably emit a warning (at least).</p>
<p>Introduce a new special block, UNITCHECK, which is run at the end of a
compilation unit (module, file, eval(STRING) block). This will correspond to
the Perl 6 CHECK. Perl 5's CHECK cannot be changed or removed because the
O.pm/B.pm backend framework depends on it.</p>
<p>Study the possibility of adding a new prototype character, <code class="inline"><span class="w">_</span></code>
, meaning
"this argument defaults to $_".</p>
<p>Make the peephole optimizer optional.</p>
<p>Allow lexical aliases (maybe via the syntax <code class="inline"><a class="l_k" href="functions/my.html">my</a> \<span class="i">$alias</span> = \<span class="i">$foo</span></code>
.</p>
<p>Fix the bugs revealed by running the test suite with the <code class="inline">-t</code>
 switch (via
<code class="inline"><span class="w">make</span> <span class="w">test</span>.<span class="w">taintwarn</span></code>
).</p>
<p>Make threads more robust.</p>
<p>Make <code class="inline"><a class="l_k" href="functions/no.html">no</a> <span class="n">6</span></code>
 and <code class="inline"><a class="l_k" href="functions/no.html">no</a> <span class="v">v6</span></code>
 work (opposite of <code class="inline"><a class="l_k" href="functions/use.html">use</a> <span class="n">5.005</span></code>
, etc.).</p>
<p>A test suite for the B module would be nice.</p>
<p>A ponie.</p>
<a name="Reporting-Bugs"></a><h1>Reporting Bugs</h1>
<p>If you find what you think is a bug, you might check the articles
recently posted to the comp.lang.perl.misc newsgroup and the perl
bug database at <a href="http://bugs.perl.org/">http://bugs.perl.org/</a> .  There may also be
information at <a href="http://www.perl.org/">http://www.perl.org/</a> , the Perl Home Page.</p>
<p>If you believe you have an unreported bug, please run the <b>perlbug</b>
program included with your release.  Be sure to trim your bug down
to a tiny but sufficient test case.  Your bug report, along with the
output of <code class="inline"><span class="w">perl</span> -<span class="w">V</span></code>
, will be sent off to perlbug@perl.org to be
analysed by the Perl porting team.</p>
<a name="SEE-ALSO"></a><h1>SEE ALSO</h1>
<p>The <i>Changes</i> file for exhaustive details on what changed.</p>
<p>The <i>INSTALL</i> file for how to build Perl.</p>
<p>The <i>README</i> file for general stuff.</p>
<p>The <i>Artistic</i> and <i>Copying</i> files for copyright information.</p>
</div>
      <div id="contentFooter"><a href="http://www.perl.org"><img src="perlpowered.png" border=0></a></div>
    </div>
  </div>

  <div id="right">
    <div id="rightContent">
      <div id="leftClose">
        <a href="#" onClick="closeRight()" title="Hide toolbar" onmouseover="rightCloseIcon.src='close_purple.gif';" onmouseout="rightCloseIcon.src='close_blue.gif';"><img src="close_blue.gif" name="rightCloseIcon" id="rightCloseIcon" border=0></a>
      </div>
      <h1>Search:</h1>
      <p>
        <form action="search.html" name="perldoc_search">
	  <input type="text" name="q" size="10" class="grey"><br>
	  <!--<select name="r"><option value="1" selected>Go to top result<option value="0">Show results list</select>-->
	</form>
      </p>
      <script language="JavaScript" type="text/javascript" src="/perl-version.js"></script>
      <h2>Labels:</h2>
      <p>
        <a href="#" onClick="addLabel('perl591delta','perl591delta.html')">Add this page</a>
      </p>
      <div class="labels" id="labels">
      </div>
    </div>
  </div>

</div>


</body>
</html>
